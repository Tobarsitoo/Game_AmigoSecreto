<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión - Amigo Secreto</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="/css/styles.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        .img-fluid {
            max-width: 126%;
        }
    </style>
</head>

<body>
    <section class="vh-100 background-section">
        <div class="content container py-5 h-100">
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col col-xl-10">
                    <div class="card" style="border-radius: 1rem;">
                        <div class="row g-0">
                            <div class="col-md-6 col-lg-5 d-none d-md-block">
                                <img src="../amigo_secreto.webp" alt="login form" class="img-fluid"
                                    style="border-radius: 1rem 0 0 1rem; height: 100%; width: 122%;" />
                            </div>
                            <div class="col-md-6 col-lg-7 d-flex align-items-center">
                                <div class="card-body p-4 p-lg-5 text-black" style="margin-left: 5rem;">
                                    <form id="loginForm" class="needs-validation" novalidate>
                                        <div class="d-flex mb-3 pb-1 justify-content-center">
                                            <img src="https://www.coopserp.com/wp1/wp-content/uploads/2024/04/Logo-grande-Coopserp-2019-e1721607356635.png"
                                                alt="" style="width: 70%; height: auto;">
                                        </div>
                                        <h5 class="fw-normal mb-3 pb-3" style="letter-spacing: 1px;">Iniciar Sesión</h5>
                                        <div class="form-outline mb-4">
                                            <label class="form-label" for="usuario">Cédula</label>
                                            <input type="text" id="usuario" class="form-control form-control-lg"
                                                name="usuario" placeholder="Ingrese su cédula, por favor" required />
                                            <div class="invalid-feedback">Por favor, ingrese su usuario.</div>
                                        </div>
                                        <div class="form-outline mb-4">
                                            <label class="form-label" for="contraseña">Contraseña</label>
                                            <input type="password" id="contraseña" class="form-control form-control-lg"
                                                name="contraseña" placeholder="Ingrese su contraseña, por favor"
                                                required />
                                            <div class="invalid-feedback">Por favor, ingrese su contraseña.</div>
                                        </div>
                                        <div class="pt-1 mb-4">
                                            <button class="btn btn-lg btn-block" style="background-color: #D1E9F6;"
                                                type="submit">Iniciar Sesión</button>
                                        </div>
                                        <div id="errorMessages" class="text-danger"></div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script>

        // Mostrar alerta informativa al cargar la página
        document.addEventListener('DOMContentLoaded', function () {
            Swal.fire({
                icon: 'info',
                title: 'Información Importante',
                text: 'Tu usuario y contraseña son tu número de cédula. Debes de tener en cuenta la fechas que te han brindado para el juego, ya que puede que al ruleta no este habilitada. Mientras tanto, puedes agregar tus preferencias de regalos y dulces para que, cuando alguien te tenga como amigo asignado, pueda conocer tus gustos y disfrutar del juego de la mejor manera.',
                confirmButtonColor: '#4A90E2',
                confirmButtonText: 'Entendido'
            });
        });

        (function () {
            'use strict';
            window.addEventListener('load', function () {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        } else {
                            handleFormSubmit(event, form);
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();

        function handleFormSubmit(event, form) {
            event.preventDefault();
            const formData = new FormData(form);
            const data = {};

            formData.forEach((value, key) => { data[key] = value });

            fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire({
                            title: 'Cargando...',
                            html: `
                                <div class="d-flex justify-content-center align-items-center">
                                    <div class="spinner-border" role="status"></div>
                                </div>
                            `,
                            timer: 1500,
                            showConfirmButton: false,
                            timerProgressBar: true,
                        }).then(() => {
                            window.location.href = data.redirect;
                        });
                    } else {
                        displayErrorMessages(data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    displayErrorMessages('Ocurrió un error al iniciar sesión');
                });
        }

        function displayErrorMessages(message) {
            const errorMessages = document.getElementById('errorMessages');
            errorMessages.textContent = message;
        }
    </script>
</body>

</html>