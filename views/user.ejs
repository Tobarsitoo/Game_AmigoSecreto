<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Amigo Secreto - Usuario</title>
    <link href="/css/styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.3/css/dataTables.bootstrap5.css">
    <style>
        .video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }

        .header-content {
            position: relative;
            z-index: 1;
            color: white;
            padding: 100px 0;
        }

        .deseos {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .deseos img {
            max-width: 100%;
            height: auto;
        }

        .empty-message {
            text-align: center;
            font-style: italic;
            color: #888;
        }

        #amigoGenero {
            font-size: 0.98rem;
            padding: 0.6em 1em;
            border-radius: 0.375rem;
        }
    </style>
</head>

<body id="page-top">

    <%- include('../partials/navbar'); %>

        <header class="position-relative">
            <video class="video-background" style="filter: brightness(50%);" autoplay muted loop>
                <source src="../donut.mp4" type="video/mp4">
                Su navegador no soporta la etiqueta de vídeo.
            </video>
            <div class="header-content text-center">
                <h1 class="fw-bolder">Bienvenido, <%= nombre %>!</h1>
                <p class="lead">Este es el juego de <span class="fw-bold text-uppercase " style="color: #FFD1E3;">AMIGO
                        SECRETO</span> , para comenzar agrega tus deseos:</p>
                        <a class="btn btn-lg" href="#deseos" style="background-color: #5BBCFF; color: #fff;">Agregar deseos</a>
            </div>
        </header>

        <!-- Deseos -->
        <section id="deseos">
            <div class="container px-4">
                <div class="row gx-4 justify-content-center">
                    <div class="col-lg-8">
                        <h2 class="text-center pb-5 text-uppercase">Lista de Deseos</h2>
                        <p class="lead">Estas son tus <span class="fw-bold text-uppercase text-warning">Deseos</span>.
                            En este apartado, podrás agregar los dulces y regalos que te gustaría recibir de tu <span
                                class="fw-bold text-uppercase text-primary">AMIGO SECRETO</span>.</p>
                        <div class="row pt-3">
                            <!-- Dulces -->
                            <div class="col-md-6 deseos">
                                <div class="card shadow-sm mb-4">
                                    <div class="card-body">
                                        <img src="../dulce.gif" alt="" class="card-img-top mb-3">
                                        <h3 class="text-center">Dulces</h3>
                                        <input type="text" id="dulceInput" class="form-control mb-2"
                                            placeholder="Agregar dulce">
                                        <button id="addDulce" class="btn btn-primary text-light w-100">Agregar
                                            Dulce</button>
                                        <table id="dulceTable" class="table table-striped mt-3">
                                            <thead>
                                                <tr>
                                                    <th>Dulces</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Aquí se agregarán los dulces -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- Regalos -->
                            <div class="col-md-6 deseos">
                                <div class="card shadow-sm mb-4">
                                    <div class="card-body">
                                        <img src="../regalo.gif" alt="" class="card-img-top mb-3">
                                        <h3 class="text-center">Regalos</h3>
                                        <input type="text" id="regaloInput" class="form-control mb-2"
                                            placeholder="Agregar regalo">
                                        <button id="addRegalo" class="btn btn-primary text-light w-100">Agregar
                                            Regalo</button>
                                        <table id="regaloTable" class="table table-striped mt-3">
                                            <thead>
                                                <tr>
                                                    <th>Regalos</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Aquí se agregarán los regalos -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Amigo -->
        <section class="bg-light py-5" id="amigo">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8 col-md-10">
                        <div class="card shadow-sm border-0">
                            <div class="card-body">
                                <h2 class="card-title text-center mb-4 text-uppercase">Información del Amigo Secreto
                                </h2>
                                <div class="row">
                                    <!-- Información básica del amigo -->
                                    <div class="col-md-12 mb-4">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h4 class="">Nombre del Amigo: <span id="amigoNombre" class="text-primary">
                                                </span></h4>
                                            <span id="amigoGenero" class="badge bg-secondary">Género</span>
                                        </div>
                                    </div>

                                    <!-- Lista de regalos -->
                                    <div class="col-md-6 mb-4">
                                        <h5 class="text-uppercase text-warning">Regalos</h5>
                                        <ul id="amigoRegalos" class="list-group">
                                            <!-- Aquí se agregarán los regalos -->
                                        </ul>
                                        <div id="noRegalos" class="empty-message text-center mt-2">No hay regalos
                                            asignados.</div>
                                    </div>

                                    <!-- Lista de dulces -->
                                    <div class="col-md-6 mb-4">
                                        <h5 class="text-uppercase text-warning">Dulces</h5>
                                        <ul id="amigoDulces" class="list-group">
                                            <!-- Aquí se agregarán los dulces -->
                                        </ul>
                                        <div id="noDulces" class="empty-message text-center mt-2">No hay dulces
                                            asignados.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>


        <!-- Footer-->
        <%- include('../partials/footer'); %>

            <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
            <script
                src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
            <script src="https://cdn.datatables.net/2.1.3/js/dataTables.js"></script>
            <script src="https://cdn.datatables.net/2.1.3/js/dataTables.bootstrap5.js"></script>
            <script src="/js/scripts.js"></script>
            <script>
                $(document).ready(function () {
                    // Inicializa DataTables
                    const dulceTable = $('#dulceTable').DataTable({
                        "language": {
                            "emptyTable": "No hay dulces añadidos aún."
                        },
                        info: false,
                        paging: false,
                        searching: false
                    });

                    const regaloTable = $('#regaloTable').DataTable({
                        "language": {
                            "emptyTable": "No hay regalos añadidos aún."
                        },
                        info: false,
                        paging: false,
                        searching: false
                    });

                    // Función para agregar dulce
                    $('#addDulce').click(function () {
                        const dulce = $('#dulceInput').val().trim();
                        if (dulce) {
                            $.post('/preferences/dulces', { dulce: dulce }, function (response) {
                                if (response.success) {
                                    dulceTable.row.add([dulce]).draw();
                                    $('#dulceInput').val('');
                                } else {
                                    alert(response.message);
                                }
                            });
                        } else {
                            alert('Por favor ingrese un dulce');
                        }
                    });

                    // Función para agregar regalo
                    $('#addRegalo').click(function () {
                        const regalo = $('#regaloInput').val().trim();
                        if (regalo) {
                            $.post('/preferences/regalos', { regalo: regalo }, function (response) {
                                if (response.success) {
                                    regaloTable.row.add([regalo]).draw();
                                    $('#regaloInput').val('');
                                } else {
                                    alert(response.message);
                                }
                            });
                        } else {
                            alert('Por favor ingrese un regalo');
                        }
                    });

                    // Función para obtener y mostrar dulces
                    $.get('/preferences/dulces', function (response) {
                        if (response.success) {
                            if (response.dulces.length > 0) {
                                response.dulces.forEach(dulce => {
                                    dulceTable.row.add([dulce.dulce]).draw();
                                });
                            }
                        } else {
                            console.error('Error al cargar dulces:', response.message);
                        }
                    });

                    // Función para obtener y mostrar regalos
                    $.get('/preferences/regalos', function (response) {
                        if (response.success) {
                            if (response.regalos.length > 0) {
                                response.regalos.forEach(regalo => {
                                    regaloTable.row.add([regalo.regalo]).draw();
                                });
                            }
                        } else {
                            console.error('Error al cargar regalos:', response.message);
                        }
                    });
                });
            </script>
            <script>
                $(document).ready(function () {
                    // Cargar la información del amigo asignado cuando se carga la página
                    fetch('/roulette/amigo-preferencias')
                        .then(response => response.json())
                        .then(data => {
                            if (data.success && data.amigo) {
                                const amigo = data.amigo;

                                // Actualiza el nombre y género del amigo con un prefijo
                                $('#amigoNombre').text(`${amigo.nombre}`);
                                $('#amigoGenero').text(`Género: ${amigo.genero}`);

                                // Asegúrate de que regalos y dulces sean arrays
                                const regalos = Array.isArray(amigo.regalos) ? amigo.regalos : [];
                                const dulces = Array.isArray(amigo.dulces) ? amigo.dulces : [];

                                // Actualiza la lista de regalos
                                const regaloList = $('#amigoRegalos');
                                regaloList.empty(); // Limpia la lista antes de agregar nuevos elementos
                                if (regalos.length > 0) {
                                    regalos.forEach(regalo => {
                                        regaloList.append(`<li class="list-group-item">${regalo}</li>`);
                                    });
                                    $('#noRegalos').hide();
                                } else {
                                    $('#noRegalos').show();
                                }

                                // Actualiza la lista de dulces
                                const dulceList = $('#amigoDulces');
                                dulceList.empty(); // Limpia la lista antes de agregar nuevos elementos
                                if (dulces.length > 0) {
                                    dulces.forEach(dulce => {
                                        dulceList.append(`<li class="list-group-item">${dulce}</li>`);
                                    });
                                    $('#noDulces').hide(); // Oculta el mensaje de vacío si hay dulces
                                } else {
                                    $('#noDulces').show(); // Muestra el mensaje de vacío si no hay dulces
                                }
                            } else {
                                $('#amigoNombre').text('No se ha asignado un amigo secreto aún.');
                                $('#amigoGenero').text('');
                            }
                        })
                        .catch(err => {
                            console.error('Error al cargar la información del amigo:', err);
                            $('#amigoNombre').text('Hubo un error al cargar la información del amigo.');
                            $('#amigoGenero').text('');
                        });
                });
            </script>
</body>

</html>