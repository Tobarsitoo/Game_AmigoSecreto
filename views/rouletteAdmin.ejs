<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Amigo Secreto - Panel de Administración</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <link rel="stylesheet" href="/css/rouletteAdmin.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.3/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.4/css/dataTables.dataTables.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body id="page-top">
    <!-- Navbar-->
    <%- include('../partials/navbaradmin'); %>

        <!-- Sección de Administración -->
        <section id="admin-panel" class="py-5">
            <div class="container" style="padding-top: 102px; padding-bottom: 349px;">
                <div class="card shadow-lg">
                    <div class="card-header text-white" style="background-color: #00712d;">
                        <h4 class="text-center mb-0">Panel de Administración</h4>
                    </div>
                    <div class="card-body">
                        <form id="admin-form">
                            <!-- Fechas -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label for="startDate" class="form-label">Fecha de inicio del Amigo Secreto:</label>
                                    <input type="date" id="startDate" class="form-control" />
                                </div>
                                <div class="col-md-6">
                                    <label for="assignDate" class="form-label">Fecha de asignación automática:</label>
                                    <input type="date" id="assignDate" class="form-control" />
                                </div>
                                <div class="justify-content-center d-flex mt-3">
                                    <button type="submit" id="" class="btn btn-success mt-2 w-25">
                                        <i class="fas fa-calendar"></i> Asignar fechas de Amigo Secreto
                                    </button>
                                </div>
                            </div>
                        </form>
                        <form>
                            <!-- Botones de acciones -->
                            <div class="row text-center">
                                <div class="col-md-4 mb-3">
                                    <button type="button" id="resetGame" class="btn btn-danger w-100">
                                        <i class="fas fa-redo-alt"></i> Reiniciar Juego
                                    </button>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <button type="button" id="resetUsers" class="btn btn-warning w-100">
                                        <i class="fas fa-users-slash"></i> Reiniciar Usuarios
                                    </button>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <button type="button" id="resetFriends" class="btn btn-success w-100">
                                        <i class="fas fa-user-friends"></i> Reiniciar Amigos Secretos
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <%- include('../partials/footer'); %>

            <!-- Scripts -->
            <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
            <script src="https://cdn.datatables.net/2.1.4/js/dataTables.js"></script>
            <script src="https://cdn.datatables.net/1.13.3/js/jquery.dataTables.min.js"></script>
            <script
                src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
            <script>
                $(document).ready(function () {
                    // Alerta para botón "Asignar fechas"
                    $('#admin-form').on('submit', function (e) {
                        e.preventDefault();
                        const startDate = $('#startDate').val();
                        const assignDate = $('#assignDate').val();

                        if (!startDate || !assignDate) {
                            Swal.fire({
                                title: 'Espera',
                                text: 'Por favor selecciona ambas fechas antes de continuar.',
                                icon: 'info',
                                confirmButtonColor: '#00712D',
                                confirmButtonText: 'Aceptar'
                            });
                        } else if (new Date(startDate) > new Date(assignDate)) {
                            Swal.fire({
                                title: 'Error',
                                text: 'La fecha de inicio no puede ser posterior a la fecha de asignación automática.',
                                icon: 'error',
                                confirmButtonText: 'Aceptar',
                                confirmButtonColor: '#dc3545',
                            });
                        } else {
                            Swal.fire({
                                title: '¿Estás seguro?',
                                text: `Fecha de inicio: ${startDate} - Fecha de asignación: ${assignDate}`,
                                icon: 'question',
                                showCancelButton: true,
                                confirmButtonText: 'Sí, asignar',
                                confirmButtonColor: '#00712D',
                                cancelButtonText: 'Cancelar',
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    $.ajax({
                                        url: '/admin/fechas',
                                        type: 'PUT',
                                        data: JSON.stringify({
                                            fecha_juego: startDate,
                                            fecha_asignacion: assignDate
                                        }),
                                        contentType: 'application/json',
                                        success: function (response) {
                                            Swal.fire({
                                                title: 'Fechas Asignadas',
                                                text: 'Las fechas han sido actualizadas correctamente.',
                                                icon: 'success',
                                                confirmButtonText: 'Aceptar',
                                                confirmButtonColor: '#00712D',

                                            });
                                        },
                                        error: function (xhr, status, error) {
                                            Swal.fire({
                                                title: 'Error',
                                                text: 'Hubo un problema al actualizar las fechas.',
                                                icon: 'error',
                                                confirmButtonText: 'Aceptar',
                                                confirmButtonColor: '#dc3545',
                                            });
                                        }
                                    });
                                }
                            });
                        }
                    });

                    $('#resetGame').on('click', function () {
                        Swal.fire({
                            title: '¿Estás seguro?',
                            text: 'Esto reiniciará todo el juego y no se podrá deshacer.',
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: 'Sí, reiniciar',
                            confirmButtonColor: '#00712D',
                            cancelButtonText: 'Cancelar',
                        }).then((result) => {
                            if (result.isConfirmed) {
                                $.ajax({
                                    url: '/admin/reset-game',
                                    type: 'POST',
                                    success: function (response) {
                                        Swal.fire({
                                            title: 'Reiniciado',
                                            text: 'El juego ha sido reiniciado.',
                                            icon: 'success',
                                            confirmButtonText: 'Aceptar',
                                            confirmButtonColor: '#00712D',

                                        });
                                    },
                                    error: function (xhr, status, error) {
                                        Swal.fire({
                                            title: 'Error',
                                            text: 'Hubo un problema al reiniciar el juego.',
                                            icon: 'error',
                                            confirmButtonText: 'Aceptar',
                                            confirmButtonColor: '#dc3545',
                                        });
                                    }
                                });
                            }
                        });
                    });
                    $('#resetUsers').on('click', function () {
                        Swal.fire({
                            title: '¿Estás seguro?',
                            text: 'Esto eliminará todos los usuarios y no se podrá deshacer.',
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: 'Sí, reiniciar',
                            confirmButtonColor: '#00712D',
                            cancelButtonText: 'Cancelar',
                        }).then((result) => {
                            if (result.isConfirmed) {
                                $.ajax({
                                    url: '/admin/reset-users',
                                    type: 'POST',
                                    success: function (response) {
                                        Swal.fire({
                                            title: 'Reiniciado',
                                            text: 'Todos los usuarios han sido reiniciados.',
                                            icon: 'success',
                                            confirmButtonText: 'Aceptar',
                                            confirmButtonColor: '#00712D',

                                        });
                                    },
                                    error: function (xhr, status, error) {
                                        Swal.fire({
                                            title: 'Error',
                                            text: 'Hubo un problema al reiniciar los usuarios.',
                                            icon: 'error',
                                            confirmButtonText: 'Aceptar',
                                            confirmButtonColor: '#dc3545',
                                        });
                                    }
                                });
                            }
                        });
                    });
                    $('#resetFriends').on('click', function () {
                        Swal.fire({
                            title: '¿Estás seguro?',
                            text: 'Esto eliminará todas las asignaciones de amigos secretos.',
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: 'Sí, reiniciar',
                            confirmButtonColor: '#00712D',
                            cancelButtonText: 'Cancelar',
                        }).then((result) => {
                            if (result.isConfirmed) {
                                $.ajax({
                                    url: '/admin/reset-friends',
                                    type: 'POST',
                                    success: function (response) {
                                        Swal.fire({
                                            title: 'Reiniciado',
                                            text: 'Los asignaciones de amigo secreto han sido eliminadas.',
                                            icon: 'success',
                                            confirmButtonText: 'Aceptar',
                                            confirmButtonColor: '#00712D',

                                        });
                                    },
                                    error: function (xhr, status, error) {
                                        Swal.fire({
                                            title: 'Error',
                                            text: 'Hubo un problema al reiniciar los amigos secretos.',
                                            icon: 'error',
                                            confirmButtonText: 'Aceptar',
                                            confirmButtonColor: '#dc3545',
                                        });
                                    }
                                });
                            }
                        });
                    });
                });
            </script>
</body>

</html>